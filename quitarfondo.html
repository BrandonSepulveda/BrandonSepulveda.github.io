<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Removedor de Fondos | Brandon Sepulveda</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/images/Logo-30.ico" />
    
    <!-- Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9012803289038112" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2RY7LG5R21"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-2RY7LG5R21');
    </script>
    
    <!-- Stylesheets (Unificadas y Mejoradas) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Fonts (Unificadas con el portafolio principal) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* --- Paleta de Colores y Estilos Base (Unificados con el Portafolio) --- */
        :root {
            --bg-dark: #000000;
            --bg-medium: #111111;
            --bg-light: #1A1A1A;
            --text-light: #FFFFFF;
            --text-muted: #999999;
            --text-muted-lighter: #b0b0b0;
            --accent-primary: #FFFFFF;
            --accent-secondary: #333333;
            --kick-color: #53FC18; /* Kick Green */
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(255, 255, 255, 0.05);
            --transition-speed: 0.4s;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-muted);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main { flex: 1 0 auto; }
        h1, h2, h3, h4, h5, h6 { font-weight: 800; color: var(--text-light); }
        .section { padding: 6rem 0; }
        .section-title { font-size: clamp(2rem, 5vw, 2.8rem); font-weight: 900; margin-bottom: 1rem; }
        .section-subtitle { font-size: 1.1rem; max-width: 650px; margin-left: auto; margin-right: auto; margin-bottom: 4rem; color: var(--text-muted-lighter); }

        /* --- Navigation Bar (Estilo unificado) --- */
        #mainNav { background-color: transparent; padding: 1.25rem 0; transition: all var(--transition-speed) ease; }
        #mainNav.navbar-scrolled { background-color: rgba(0, 0, 0, 0.75); backdrop-filter: blur(15px); padding: 0.75rem 0; border-bottom: 1px solid var(--border-color); }
        #mainNav .navbar-brand { color: var(--text-light); font-weight: 800; font-size: 1.25rem; }
        #mainNav .navbar-brand img { transition: transform var(--transition-speed) ease; }
        #mainNav .navbar-brand:hover img { transform: rotate(-15deg); }
        #mainNav .nav-link { color: var(--text-muted); font-weight: 600; padding: 0.5rem 1rem; transition: color var(--transition-speed) ease; }
        #mainNav .nav-link:hover, #mainNav .nav-link.active { color: var(--text-light); }
        #mainNav .navbar-toggler { border: 1px solid var(--border-color); }
        #mainNav .navbar-toggler-icon { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.8%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e"); }

        /* --- MEJORA: Contenedor principal de la herramienta --- */
        .tool-container {
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 2rem;
        }

        /* --- MEJORA: Área de carga de archivos --- */
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            padding: 2.5rem;
            text-align: center;
            cursor: pointer;
            background-color: var(--bg-medium);
            transition: all var(--transition-speed) ease;
        }
        .upload-area.dragover {
            border-color: var(--kick-color);
            background-color: var(--accent-secondary);
            transform: scale(1.02);
        }
        .upload-area i {
            font-size: 3rem;
            color: var(--kick-color);
            margin-bottom: 1rem;
        }

        /* --- MEJORA: Paneles de control --- */
        .control-panel {
            background-color: var(--bg-medium);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }
        .control-panel label {
            font-weight: 600;
            color: var(--text-muted-lighter);
            margin-bottom: 0.75rem;
            display: block;
        }

        /* --- MEJORA: Estilos de controles (Color, Slider) --- */
        input[type="color"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 50px;
            height: 50px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--accent-secondary);
            border-radius: 5px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--kick-color);
            cursor: pointer;
            border-radius: 50%;
        }
        .slider-value {
            min-width: 40px;
            text-align: center;
            background-color: var(--bg-light);
            padding: 5px 10px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* --- MEJORA: Área de previsualización --- */
        .preview-container {
            background-color: var(--bg-medium);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .preview-container h5 {
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        canvas {
            max-width: 100%;
            border-radius: 5px;
            background-image: 
                linear-gradient(45deg, var(--accent-secondary) 25%, transparent 25%), 
                linear-gradient(-45deg, var(--accent-secondary) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, var(--accent-secondary) 75%),
                linear-gradient(-45deg, transparent 75%, var(--accent-secondary) 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        /* --- Botones (Estilo unificado) --- */
        .btn { padding: 0.8rem 2rem; font-weight: 700; border-radius: 50px; transition: all var(--transition-speed) ease; border: 2px solid transparent; }
        .btn-kick { background-color: var(--kick-color); color: var(--bg-dark); box-shadow: 0 0 20px rgba(83, 252, 24, 0.3); }
        .btn-kick:hover:not(:disabled) { background-color: var(--kick-color); color: var(--bg-dark); transform: translateY(-3px) scale(1.05); box-shadow: 0 0 30px rgba(83, 252, 24, 0.5); }
        .btn-outline-light { color: var(--text-light); border-color: var(--accent-secondary); }
        .btn-outline-light:hover:not(:disabled) { background-color: var(--accent-primary); color: var(--bg-dark); border-color: var(--accent-primary); transform: translateY(-3px); }
        .btn.disabled, .btn:disabled { background-color: var(--accent-secondary); border-color: var(--accent-secondary); color: var(--text-muted); cursor: not-allowed; transform: none; box-shadow: none; }

        /* --- MEJORA: Spinner de carga --- */
        .loading-spinner {
            border: 4px solid var(--border-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border-left-color: var(--kick-color);
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Footer (Estilo unificado) --- */
        footer { background-color: var(--bg-medium); padding: 3rem 0; border-top: 1px solid var(--border-color); }
    </style>
</head>
<body>
    <!-- Navegación Unificada -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://github.com/BrandonSepulveda/BrandonSepulveda.github.io/blob/main/logo/Logo-30.png?raw=true" alt="Logo" style="height: 30px; width: auto; margin-right: 10px;">
                Brandon Sepulveda
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="herramientas.html">Herramientas</a></li>
                    <li class="nav-item"><a class="nav-link active" href="#">Removedor de Fondos</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main>
        <section class="section">
            <div class="container">
                <!-- Cabecera de la sección -->
                <div class="text-center" data-aos="fade-up">
                    <h2 class="section-title">Removedor de Fondos Mágico</h2>
                    <p class="section-subtitle">
                        Sube una imagen, elige el color a eliminar y ajusta la tolerancia para un recorte perfecto. Todo el procesamiento se realiza en tu navegador.
                    </p>
                </div>

                <div class="tool-container" data-aos="fade-up" data-aos-delay="100">
                    <div class="row g-4">
                        <!-- Columna de Controles -->
                        <div class="col-lg-4">
                            <!-- Paso 1: Cargar Imagen -->
                            <div class="upload-area mb-4" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h5>Cargar Imagen</h5>
                                <p class="small text-muted">Haz clic o arrastra un archivo aquí</p>
                                <input type="file" id="fileInput" accept="image/*" class="d-none">
                            </div>

                            <!-- Paso 2: Controles de Ajuste -->
                            <div id="controlsPanel" class="d-none">
                                <div class="control-panel mb-3">
                                    <label><i class="fas fa-palette me-2"></i>Color a Remover</label>
                                    <div class="d-flex align-items-center gap-3">
                                        <input type="color" id="colorPicker" value="#ffffff">
                                        <button id="pickFromImageBtn" class="btn btn-outline-light flex-grow-1" style="padding: 0.5rem 1rem;">
                                            <i class="fas fa-eye-dropper"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-panel">
                                    <label><i class="fas fa-sliders-h me-2"></i>Tolerancia</label>
                                    <div class="d-flex align-items-center gap-3">
                                        <input type="range" id="toleranceSlider" min="0" max="200" value="30">
                                        <span class="slider-value" id="toleranceValue">30</span>
                                    </div>
                                </div>
                                <div class="d-grid mt-4">
                                    <button id="processButton" class="btn btn-kick"><i class="fas fa-magic me-2"></i>Procesar Imagen</button>
                                </div>
                            </div>
                        </div>

                        <!-- Columna de Previsualización -->
                        <div class="col-lg-8">
                            <div id="previewArea" class="d-none">
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="preview-container">
                                            <h5><i class="fas fa-image me-2"></i>Original</h5>
                                            <canvas id="originalCanvas"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="preview-container">
                                            <h5><i class="fas fa-wand-magic-sparkles me-2"></i>Resultado</h5>
                                            <canvas id="transparentCanvas"></canvas>
                                            <div id="loadingIndicator" class="d-none justify-content-center my-3">
                                                <div class="loading-spinner"></div>
                                            </div>
                                            <div id="downloadContainer" class="d-grid d-none">
                                                <button id="downloadButton" class="btn btn-kick"><i class="fas fa-download me-2"></i>Descargar PNG</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="welcomeMessage" class="d-flex align-items-center justify-content-center h-100 text-center text-muted p-5" style="border: 2px dashed var(--border-color); border-radius: 10px;">
                                <div>
                                    <i class="fas fa-image fa-3x mb-3"></i>
                                    <h4>El área de previsualización aparecerá aquí</h4>
                                    <p>Comienza por cargar una imagen.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer Unificado -->
    <footer class="footer text-center">
        <div class="container">
            <p class="text-muted mb-0">Copyright &copy; Jhon Brandon Sepulveda Valdes 2025</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Inicializar AOS
            AOS.init({ duration: 800, once: true, offset: 50 });

            // Efecto de scroll para la barra de navegación
            const mainNav = document.getElementById('mainNav');
            if (mainNav) {
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 50) mainNav.classList.add('navbar-scrolled');
                    else mainNav.classList.remove('navbar-scrolled');
                });
            }

            // --- LÓGICA DEL REMOVEDOR DE FONDOS ---
            let originalImage = null;
            let isPickingColor = false;

            // Elementos del DOM
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            const colorPicker = document.getElementById('colorPicker');
            const pickFromImageBtn = document.getElementById('pickFromImageBtn');
            const toleranceSlider = document.getElementById('toleranceSlider');
            const toleranceValue = document.getElementById('toleranceValue');
            const processButton = document.getElementById('processButton');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const previewArea = document.getElementById('previewArea');
            const originalCanvas = document.getElementById('originalCanvas');
            const transparentCanvas = document.getElementById('transparentCanvas');
            const downloadContainer = document.getElementById('downloadContainer');
            const downloadButton = document.getElementById('downloadButton');
            const controlsPanel = document.getElementById('controlsPanel');

            // Contextos de los canvas
            const originalCtx = originalCanvas.getContext('2d', { willReadFrequently: true });
            const transparentCtx = transparentCanvas.getContext('2d');

            // Cargar y mostrar la imagen
            const loadImage = (file) => {
                if (!file || !file.type.match('image.*')) return;

                const reader = new FileReader();
                reader.onload = e => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        // Mostrar paneles y ocultar mensaje de bienvenida
                        welcomeMessage.classList.add('d-none');
                        previewArea.classList.remove('d-none');
                        controlsPanel.classList.remove('d-none');
                        downloadContainer.classList.add('d-none');
                        
                        // Ajustar tamaño del canvas manteniendo la proporción
                        const maxCanvasWidth = originalCanvas.parentElement.clientWidth;
                        const scale = Math.min(1, maxCanvasWidth / originalImage.width);
                        const canvasWidth = originalImage.width * scale;
                        const canvasHeight = originalImage.height * scale;

                        originalCanvas.width = transparentCanvas.width = canvasWidth;
                        originalCanvas.height = transparentCanvas.height = canvasHeight;

                        // Dibujar imagen original
                        originalCtx.drawImage(originalImage, 0, 0, canvasWidth, canvasHeight);
                    };
                    originalImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            };
            
            // Procesar la imagen para remover el fondo
            const processImage = () => {
                if (!originalImage) return;

                loadingIndicator.classList.remove('d-none');
                downloadContainer.classList.add('d-none');
                transparentCtx.clearRect(0, 0, transparentCanvas.width, transparentCanvas.height);

                setTimeout(() => {
                    // Usar un canvas temporal con la resolución original para el procesamiento
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = originalImage.width;
                    tempCanvas.height = originalImage.height;
                    const tempCtx = tempCanvas.getContext('2d', { willReadFrequently: true });
                    tempCtx.drawImage(originalImage, 0, 0);

                    const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
                    const data = imageData.data;
                    const targetColor = hexToRgb(colorPicker.value);
                    const tolerance = parseInt(toleranceSlider.value);

                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];

                        const diff = Math.sqrt(
                            Math.pow(r - targetColor.r, 2) +
                            Math.pow(g - targetColor.g, 2) +
                            Math.pow(b - targetColor.b, 2)
                        );

                        if (diff < tolerance) {
                            data[i + 3] = 0; // Hacer transparente
                        }
                    }

                    tempCtx.putImageData(imageData, 0, 0);
                    
                    // Dibujar el resultado en el canvas visible
                    transparentCtx.drawImage(tempCanvas, 0, 0, transparentCanvas.width, transparentCanvas.height);

                    loadingIndicator.classList.add('d-none');
                    downloadContainer.classList.remove('d-none');
                }, 50);
            };

            // Descargar la imagen resultante
            const downloadImage = () => {
                const link = document.createElement('a');
                link.download = 'imagen_sin_fondo.png';
                link.href = transparentCanvas.toDataURL('image/png');
                link.click();
            };

            // Activar/desactivar el modo de selección de color
            const toggleColorPicking = (enable) => {
                isPickingColor = enable;
                originalCanvas.style.cursor = enable ? 'crosshair' : 'default';
                pickFromImageBtn.classList.toggle('active', enable);
                if (enable) {
                    pickFromImageBtn.innerHTML = '<i class="fas fa-times"></i>';
                } else {
                    pickFromImageBtn.innerHTML = '<i class="fas fa-eye-dropper"></i>';
                }
            };
            
            // Convertir color HEX a RGB
            const hexToRgb = (hex) => {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null;
            };

            // Convertir RGB a HEX
            const rgbToHex = (r, g, b) => "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();

            // Event Listeners
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', e => loadImage(e.target.files[0]));
            
            // Drag & Drop
            uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
            uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
            uploadArea.addEventListener('drop', e => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                loadImage(e.dataTransfer.files[0]);
            });

            toleranceSlider.addEventListener('input', () => toleranceValue.textContent = toleranceSlider.value);
            processButton.addEventListener('click', processImage);
            downloadButton.addEventListener('click', downloadImage);
            
            pickFromImageBtn.addEventListener('click', () => toggleColorPicking(!isPickingColor));

            originalCanvas.addEventListener('click', e => {
                if (!isPickingColor) return;
                const rect = originalCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Escalar coordenadas al tamaño real de la imagen
                const scaleX = originalCanvas.width / rect.width;
                const scaleY = originalCanvas.height / rect.height;

                const pixelData = originalCtx.getImageData(x * scaleX, y * scaleY, 1, 1).data;
                colorPicker.value = rgbToHex(pixelData[0], pixelData[1], pixelData[2]);
                toggleColorPicking(false);
            });
        });
    </script>
</body>
</html>
